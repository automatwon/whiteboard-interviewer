<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<script src="https://cdn.firebase.com/v0/firebase.js"></script>
<script src="codemirror/lib/codemirror.js"></script>
<script src="codemirror/mode/meta.js"></script>
<script id="langScript" src="codemirror/mode/clike/clike.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<link rel="stylesheet" href="codemirror/lib/codemirror.css" />
<script src="firepad.js"></script>
<link rel="stylesheet" href="firepad.css" />
<script src="example-helper.js"></script>

<style>
html { height: 100%; }
body { margin: 0; height: 100%; position: relative; }
</style>

</head>

<body>


<div id="firepad-container"></div>

<script>

function initFirepad(languageMode, languageMime, containerId){
  var scriptSrc = "codemirror/mode/" + languageMode + "/" + languageMode + ".js";
  $("#langScript").attr("src", scriptSrc);
  $.getScript(scriptSrc);
  $("#" + containerId).html("");
  var firepadRef = new Firebase('https://whiteboard-interviewer.firebaseIO.com/editor2');
  var codeMirror = CodeMirror(document.getElementById(containerId), {lineNumbers: true, mode: languageMime});
  var firepad = Firepad.fromCodeMirror(firepadRef, codeMirror, {richTextToolbar: true});
  $(".firepad-toolbar").append("<div class='firepad-btn-group'>Language Mode : <select id='languages'></select></div>");
  var active = 0;
  $.each(CodeMirror.modeInfo, function (index, value){
    $("#languages").append("<option id='lang" + index + "' value='" + index + "'> " + value.name + " </option>");
    if(value.mime === languageMime) active = index;
  });
  $("#lang" + active).attr("selected", "selected");
  $("#languages").change(langChanged);
}

function langChanged(){
  var langId = $("#languages").val();
  var langMode = CodeMirror.modeInfo[langId].mode;
  var langMime = CodeMirror.modeInfo[langId].mime;
  initFirepad(langMode, langMime, "firepad-container");
}

$(document).ready(function(){
  CodeMirror.modeInfo.sort(function(a,b){
    var aName = a.name.toLowerCase();
    var bName = b.name.toLowerCase(); 
    return ((aName < bName) ? -1 : ((aName > bName) ? 1 : 0));
  });
  initFirepad("clike", "text/x-java", "firepad-container" );
}); 

</script>

</body>

</html>